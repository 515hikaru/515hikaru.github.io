---
title: "Go言語でつくるインタプリタを読んだ"
date: 2018-09-29T21:00:00+09:00
draft: false
categories: ["Golang", "Studying"]
---

# Go 言語で Monkey 言語のインタプリタをつくった

[『Go 言語でつくるインタプリタ』](https://www.amazon.co.jp/Go%E8%A8%80%E8%AA%9E%E3%81%A7%E3%81%A4%E3%81%8F%E3%82%8B%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%97%E3%83%AA%E3%82%BF-Thorsten-Ball/dp/4873118220/ref=sr_1_1?ie=UTF8&qid=1538222383&sr=8-1&keywords=Go%E8%A8%80%E8%AA%9E%E3%81%A7%E3%81%A4%E3%81%8F%E3%82%8B)という本がある。Go言語で標準パッケージ以外を利用せずにインタプリタを作ることを目標にした本だ。これを読み終え、実装もしおえた。

[515hikaru/monkey\-go: Go言語で作るインタプリタを実際に作るリポジトリ](https://github.com/515hikaru/monkey-go)

発売してすぐに買ったから家には6月からあったと思うけど、全部終えるのに結局3ヶ月以上かかった。といっても買ってから3時間くらいで1章を読んで、2章を本腰を入れて読み始めたのは一週間前のことだから、実質実装する時間を含めて読んだのは24時間[^1]くらいだと思う。

技術書を最初から最後まで[^2]読んだのはいつ以来だろうか。わからないけど、たぶん1年は前のことじゃないかと思う。

[^1]: 仕事してからはどうしてもせいぜい1時間くらいしか時間が使えないので、休日を2日、平日を5日に+αで、8+8+1*5+3で24時間

[^2]: 付録のマクロシステムは実装する気になれなくて飛ばしたけど)

<!--more-->

# 感想

## TDD

あまり前面に押し出していないが、この本は全行程をTDD(テスト駆動開発)で行っている。ものづくりの際にTDDがいかに有効かということを実体験できたのがいい誤算だった。

テストを先に書く、というのは自分が *ユーザーの視点に立って* 欲しいものを決める、ということであり、あとでそれを実現する実装を書くということを実体験すると、ユーザーの期待通りのもの(つまりわたしが欲していたもの)が得られる。頭ではわかっていたが、やはり実体験すると違う。

作者は「テストがどのように失敗するか」も本のなかで示してくれているので、実際に実行したエラーが自分の環境で起きたものとテストコードが間違っていることがわかったりする。

ほとんどのコードを示してくれているので、実装で困ることはないと思う。Go言語の文法の説明は基本的にないのでもしかしたら[『スターティングGo言語』](https://www.amazon.co.jp/%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0Go%E8%A8%80%E8%AA%9E-CodeZine-BOOKS-%E6%9D%BE%E5%B0%BE-%E6%84%9B%E8%B3%80/dp/4798142417/ref=sr_1_1?ie=UTF8&qid=1538223334&sr=8-1&keywords=%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0Go%E8%A8%80%E8%AA%9E)くらいは眺めておいたほうがいいかも。あと普通に書き写しているとLintツールに怒られることがあるようなコードではある。

## Go言語の開発体験

わたしは Go 言語では競技プログラミングの簡単な問題を解く、以外の使い方をほとんどしたことがなかったので、なにかひとつのものを Go 言語で作ったのは初めてだ。

最初は成功しているか失敗しているかわからない処理については幾度も幾度も `if foo, ok := ...; ok {}` と書いていたのとか非常に違和感[^3]があったが、そのうち慣れた。ただ、正直構文解析のテストコードを書いているときは飽きた。`!ok` のときに何度も似たようなエラーメッセージを `t.Errorf("...")` と書いたので。ただ、これは本の通りにやったからであって、定数でフォーマット文字列をあらかじめ用意しておくとかしておけば多少は緩和されたのかもしれない。

[^3]: 特有のイディオムに見慣れていなかったというのもあると思う。

ただ先述のように Go 言語の強みとかには特に触れられていない(たとえば並行処理は本書の中で出てこない)ので、Go言語だからこういう機能開発が楽にできる、みたいな体験はなかった。もちろん、Monkey言語で実装したいデータ型が Go 言語には既にあるから楽、という側面はあったが、それは単にデータ型が定義されているというだけの話だ。

## 動く原理の探求することの楽しさ

インタプリタがどのように動作するのか、言語処理系はソースコード(それはつまりなんらかの規則に則った文字列)をどのように "解釈" するのかを自分がソースコードを書いて理解するというのが楽しかった。今までプログラミング言語はアプリオリに与えられているもので、自分はユーザーでしかいられないという感覚があった[^4]。

しかし、自分で作ることで単に与えられたものではなく誰かが作ったものであること、そして「自分にも作れるものであること」(なぜなら実際に作ったからだ)が実感できた今となっては、そういう疑念は払拭された。

その動作原理を一応理解している今、わたしは `let foo = 12;` の `let` が気に入らないと思ったら `foo let = 43;` で `let` という変数を定義させることもできるのだ。しないけど。

[^4]: 情報系の人がコンパイラを作る講義があって、みたいな話を聞くたびに羨ましいなと思ったものだ。

## ものづくりの楽しさ

やはりものを作るのは楽しい。眼の前で動くものならなおさらだ。

久々に仕事以外でものづくりができた。かなり満足だ。

# まとめ

- Go言語を学びたい人にはあまりおすすめではない
- Go言語を少しかじったことある人でインタプリタや言語処理系が「なぜ動くか」に興味がある人には非常におすすめ
- 「なぜ」を知りたい人におすすめ
- (主眼ではないけど)TDDも実体験できる
